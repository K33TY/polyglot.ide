<!-- Common definitions. (Externally sourced by JL7 IDE.) -->

<project name="jl5-ide.common">
  <dirname property="jl5-ide.home" file="${ant.file.jl5-ide.common}"/>

  <!-- Ensure config.properties exists. -->
  <copy todir="${jl5-ide.home}">
    <fileset file="${jl5-ide.home}/config.properties.in">
      <present targetdir="${jl5-ide.home}" present="srconly">
        <mapper type="glob" from="*.in" to="*"/>
      </present>
    </fileset>
    <mapper type="glob" from="*.in" to="*"/>
  </copy>

  <!-- Import common definitions. -->
  <property file="${jl5-ide.home}/config.properties" prefix="config"/>

  <!-- Read in version information. -->
  <property file="${jl5-ide.home}/version.properties"
      prefix="jl5-ide"/>
  <property name="jl5-ide.version"
      value="${jl5-ide.version.major}.${jl5-ide.version.minor}.${jl5-ide.version.patch}"/>

  <!--
       Polyglot IDE location

       If polyglot-ide.home is not defined in the properties file, default
       to ${jl5-ide.home}/../polyglot.ide
  -->
  <condition property="polyglot-ide.home"
      value="${config.polyglot-ide.home}"
      else="${jl5-ide.home}/../polyglot.ide">
    <isset property="config.polyglot-ide.home"/>
  </condition>

  <!-- Import Polyglot IDE common definitions. -->
  <import file="${polyglot-ide.home}/common.xml" optional="true"/>

  <!-- JL5 IDE classpath (includes dependencies) -->
  <path id="jl5-ide.classpath">
    <pathelement path="${jl5-ide.home}/classes"/>
    <path refid="polyglot-ide.classpath"/>
  </path>

  <!--
  ________________________________________________________________________
  Check configuration.
  -->

  <echo message="Polyglot IDE home directory is ${polyglot-ide.home}"/>

  <!-- Check for presence of Polyglot IDE. -->
  <condition property="polyglot-ide.exists" value="true">
    <and>
      <isreference refid="polyglot-ide.classpath"/>
      <available classname="polyglot.ide.JLPluginInfo"
          classpathref="polyglot-ide.classpath"/>
    </and>
  </condition>

  <!--
       Error handling: Polyglot IDE not found and polyglot-ide.home not set in
       config.properties.
  -->
  <fail message="Failed to find Polyglot IDE. Set the 'polyglot-ide.home' property in ${jl5-ide.home}/config.properties, and make sure Polyglot IDE is built.">
    <condition>
      <and>
        <isfalse value="${polyglot-ide.exists}"/>
        <not><isset property="config.polyglot-ide.home"/></not>
      </and>
    </condition>
  </fail>

  <!-- Error handling: Polyglot IDE not found. -->
  <fail message="Failed to find Polyglot IDE. Ensure the 'polyglot-ide.home' property is correct in '${jl5-ide.home}/config.properties' and make sure Polyglot IDE is built.">
    <condition>
      <isfalse value="${polyglot-ide.exists}"/>
    </condition>
  </fail>
</project>
